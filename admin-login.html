<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Login - Kantin Digital</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="min-h-screen bg-gray-100 flex items-center justify-center p-6">
<div class="max-w-md w-full bg-white p-8 rounded-2xl shadow-xl">
  <h2 class="text-2xl font-bold mb-6 text-center">Login Admin</h2>
  <input id="email" class="w-full p-3 border rounded mb-4" placeholder="Email admin" />
  <input id="pass" type="password" class="w-full p-3 border rounded mb-6" placeholder="Password" />
  <button onclick="doLogin()" class="w-full py-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700">Login</button>
</div>

<script type="module">
import { login, db } from './js/firebase.js';
import { ref, get } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

async function doLogin(){
  const email = document.getElementById('email').value.trim();
  const pass = document.getElementById('pass').value.trim();
  if(!email||!pass) return Swal.fire('Error','Isi email & password','warning');

  try{
    const cred = await login(email, pass);
    const uid = cred.user.uid;
    const snapshot = await get(ref(db, `users/${uid}`));
    const data = snapshot.val();
    if(!data) throw new Error('Data tidak ditemukan');
    if(data.role!=='admin') throw new Error('Bukan akun admin');

    Swal.fire('Sukses','Login berhasil','success').then(()=> location.href='admin-dashboard.html');
  }catch(err){
    Swal.fire('Gagal Login', err.message || 'Login gagal', 'error');
  }
}
</script>
</body>
</html>
